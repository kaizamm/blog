---
layout: post
published: true
title:  k8s 之 ingress
categories: [ k8s ]
tags: [ ingress ]
---
* content
{:toc}

# 什么是 ingress？

ingress 是 在 service 上面，流量从 ingress 进入，相当于是七层负载。既然是七层负载，可以想到，可以根据 path uri header 这些参数通过路由规则来实现流量分发或是 url 重写。
另外还有个 ssl 卸载的功能。

ingress 分为 controller 和 ingress resource。

controller 有很多，比如：

+  K8s community ingress controller：这个是默认的，nginx 用的 lua 模块，功能虽然多了点，但是 reload 慢，稳定性不是很好。

+ nginx官方出了个 NGINX INGRESS controller： 用的是 nginx 原生的，没有第三方模块，解决了 reload 慢的问题。

Nginx Plus 收费，在官网上注册后可以下载证书和私钥，免费使用一个月。控制器的安装方法：把证书私钥拷备到当前目录-打包镜像时指定自己的私有仓库地址（打包完镜像会自动上传至镜像仓库）-deployment 里面需要指定刚才这个镜像。

+ traefic: 有漂亮的 UI，用的人比较多。

+ kong: 也是基于 nginx的。

+ istio
...

![详情](/styles/images/ingress-controllers.png)


那么 controller 到底是什么呢？有什么作用？

controller是以 service 形式呈现的。既然是 service，那么它的 type 可以是 NodePort/LoadBalance，因此可以将服务暴露出来，然后外部流量可以从这个端口进入。

这个地方是 Ingress 的流量的入口。

它是个控制器，既然是控制器，故名思议，控制器一般是从某个地方读取配置文件，然后将它生成内部核心程序能认识的配置文件，然后让这个核心程序能够尽量去达到这个状态。

那这个这个核心程序就是 nginx ，配置规则的地方就是 ingress 这个资源，生成的其实是 nginx 的配置文件。然后 nginx 就根据这个配置文件去实现功能。

