---
layout: post
published: true
title: 证书加密
categories: [document]
tags: [go]
---
* content
{:toc}

## 前言

最近搞istio升级时，经常碰到mTLS加密的问题。恰好最近有同事问到双向加密的事情，感觉每次都是看完当时懂，过后又感觉只是一知半解，讲不清楚。此次做个总结。

## 为什么一般是有一个证书跟一个私钥

证书其实就是公钥，包含颁发机构、过期时间，是个锁头，可以对数据进行加密，只有自已的私钥能够解开。

1. 客户端请求服务端（如请求https），服务端会把证书发给客户端；

2. 证书即是公钥，客户端校验（ssl/tls）里面的过期时间、颁发机构是否合法（如果不合法，浏览器会有弹出提醒）；

3. 客户端校验公钥正常后，生成一个随机数，然后使用公钥把这个随机值进行加密（公钥是个锁头，可以把数据锁起来），然后发送给服务端；

4. 服务端通过私钥解析出随机值，然后把客户端请求的内容通过这个随机值加密（ssl/tls），发送给客户端；

5. 客户端通过随机值对这个数据进行解密，这样就能收到服务端发送过来的数据。

## 什么是对称加密？什么是非对称加密

一般的对称加密像这样：

encrypt(明文，秘钥) = 密文

decrypt(密文，秘钥) = 明文

复制代码也就是说加密和解密用的是同一个秘钥。而非对称加密是这样的：

encrypt(明文，公钥) = 密文

decrypt(密文，私钥) = 明文

## 证书

访问掘金，点击https的锁头，查看证书。
可以看到根证书/中级证书，然后到自已这个证书。

![证书](/styles/images/证书.jpg)
