---
layout: post
title:  kvm安装及虚拟机创建
date:   2018-05-23  
categories: project
tag:
  - kvm
  - 虚拟化
  - 云计算

---
* content
{:toc}

### 系统环境
Vmware Workstation<br>
系统版本：CentOS Linux release 7.5.1804 (Core)<br>
内存：4GB<br>
额外：勾选vt-x<br>
bonding<br>
注意：vmare的网关为x.x.x.2，所以nameserver也要设置为x.x.x.2<br>

### 安装KVM Qemu Libvirt

#### 是否支持硬件虚拟化
确定机器有VT,如果flags: 里有vmx 或者svm就说明支持VT；如果没有任何的输出，说明你的cpu不支持，将无法使用KVM虚拟机。
```
grep -E -o '(vmx|svm)' /proc/cpuinfo
```

确保BIOS里开启VT:
```
Intel(R) Virtualization Tech [Enabled]
```

查看内核中是否有KVM模块
```
#lsmod|grep kvm
kvm_intel             148081  0
kvm                   461126  1 kvm_intel
#如果无相关信息，手动加载下
modprobe kvm-intel
```

#### 桥接网络
安装工具
```
yum install bridge-utils -y
```
复制ifcfg-eth0 为 ifcfg-br0，并将ifcfg-br0改为如下配置
```
tee /etc/sysconfig/network-scripts/ifcfg-br0 <<EOF
TYPE=Bridge
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
NAME=br0
DEVICE=br0
ONBOOT=yes
IPADDR=192.168.56.13
NETMASK=255.255.255.0
GATEWAY=192.168.56.2
EOF
```
原网卡ifcfg-em1只保留如下配置,其他都注释掉：
```
tee /etc/sysconfig/network-scripts/ifcfg-eth0<<EOF
NAME=eth0
DEVICE=eth0
ONBOOT=yes
BRIDGE=br0
EOF
```
#### 安装qemu-kvm
```
yum -y install qemu-kvm libvirt virt-install bridge-utils -y
systemctl start libvirtd && systemctl enable libvirtd
```
