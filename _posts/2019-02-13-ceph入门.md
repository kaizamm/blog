---
layout: post
published: true
title:  ceph入门
categories: [document]
tags: [存储]
---
* content
{:toc}

### 前言
最近应该会有段时间不忙，研究下ceph，说到存储，之前做过总结，但总不能沉到下面的技术中去，一直浮在上面的概念上面，希望能借助于本节对ceph做个拓展；  
存储关键字：nas san das lvs 块存储 分布式存储 对象存储 文件存储 ceph  
初步理解：存储分为三种：
1. 块存储：如裸设备存储，DAS，即直接连接存储，如磁盘就是这种，SAN,存储区域网络，磁盘阵列也是这种，在存储时，将数据分割成小的数据块；引申：磁盘的存储方式：扇区、block size、簇；扇区是最小的存储单元，但是系统在存取或读取一个文件时，不可能只读一个扇区，而是以block为最小单位；  
2. 文件存储：主要是cifs或是nfs协议，有文件服务器，传输速度快，如ftp；主要是通过网络共享，nas  
3. 对象存储：对象存储将数据与元数据分离，改变了传统数据存储的方式，传统的存储有点类似链表形式，需要进行遍历；而对象存储则是将元数据分离后统一进行存储，那么在访问某个文件时，只需要拿到它的元数据，就能找到它的存储地址，从而进行访问；所谓元数据，是指这个存储对象的创建时间、访问时间、大小等，说白了就是inode；能通过inode来索引文件，关于inode的详细信息，可以参考[阮一峰的网络日志](http://www.ruanyifeng.com/blog/2011/12/inode.html)  
> 关于硬链接，Inode号相同的，文件名不同的两个文件，修改一个文件中的内容，可以导致另一个文件中的内容同时发生变化，而删除这个文件，不会引起另一个文件的删除；有了inode，可以删除那些通过文件名不好删除的文件；``` find . -inum 271761664  -exec rm -i {} \;```


### 内容
[官网](http://docs.ceph.com/docs/master/start/intro/)  
ceph支持块存储、文件存储和对象存储；  
ceph存储集群至少需要一个monitor,manager,OSD(Object Storage Daemon)，如果ceph文件系统客户端，也需要一个Metadata Server(MDSs)

+ Monitors: ceph-mon,主要是集群中的映射关系，如Monitor map，manager map,OSD map和CRUSH map;这些映射关系保证了守护进程之间的信息传递；mointor同时也负责守护进程和client之间的认证；为了保证高可用，至少需要三个mointor  
+ Managers: ceph-mgr,监控集群的状态，它有基于python的插件，提供Dashboad和rest API;同样为了保证高可用，至少要有两个manager  
+ Ceph OSDS：ceph-osd,数据存储、数据复制、数据恢复、维护集群之间的心跳；至少保证3个节点  
+ MDSs: ceph-mds,存储元数据，对象存储和块存储不使用MDS,只在文件存储时使用;metadata sever允许使用执行基本的命令，如：find,ls  
ceph存储数据时按逻辑存储池存储对象，利用CRUSH算法，它会计算哪个placement group来存储对象，并且会计算哪个OSD守护进程来存储placement group,这个算法来保证存储集群弹性伸缩、重新平衡和动态恢复
